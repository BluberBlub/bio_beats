# IONOS default settings often disable directory listing
# and expect index.html
DirectoryIndex index.html

# Prevent listing of directories without index file
Options -Indexes

# Custom 404 page
ErrorDocument 404 /404.html

<IfModule mod_mime.c>
  AddType image/svg+xml .svg
  AddType application/manifest+json .webmanifest
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # 0. KEY FIX (v2 Safe Mode): 
  # If request starts with /client/, Stop rewriting and serve file.
  # This prevents loops and 500 errors on shared hosts.
  RewriteRule ^client/ - [L]
  
  # 1. Assets & System Files (Legacy support for /_astro/ requests)
  RewriteRule ^_astro/(.*)$ /client/_astro/$1 [L]
  RewriteRule ^fonts/(.*)$ /client/fonts/$1 [L]
  RewriteRule ^assets/(.*)$ /client/assets/$1 [L]
  RewriteRule ^artists/(.*)\.png$ /client/artists/$1.png [L]
  RewriteRule ^site\.webmanifest$ /client/site.webmanifest [L]
  RewriteRule ^sitemap(.*)\.xml$ /client/sitemap$1.xml [L]
  RewriteRule ^robots\.txt$ /client/robots.txt [L]
  
  # Specific root files if missing
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^logo\.svg$ /client/logo.svg [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^favicon\.(svg|ico)$ /client/favicon.$1 [L]

  # 2. Page Routing (HTML)
  # If request points to a directory in /client that has an index.html, serve it.
  RewriteCond %{DOCUMENT_ROOT}/client/%{REQUEST_URI}/index.html -f
  RewriteRule ^(.*)$ /client/$1/index.html [L]
  
  # If request points to a direct HTML file in /client
  RewriteCond %{DOCUMENT_ROOT}/client/%{REQUEST_URI}.html -f
  RewriteRule ^(.*)$ /client/$1.html [L]
  
  # Fallback: if it works in /client directly
  RewriteCond %{DOCUMENT_ROOT}/client/%{REQUEST_URI} -f
  RewriteRule ^(.*)$ /client/$1 [L]
</IfModule>
