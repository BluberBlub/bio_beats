
# FIXED CONFIGURATION - Bio Beats (Iteration 5 - Safe Mode)
# Removed complex conditionals. Relies on order and regex.

DirectoryIndex index.html
ErrorDocument 404 /404.html

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # ----------------------------------------------------------------------
  # 1. Prevent Loops & Pass-through
  # ----------------------------------------------------------------------
  
  RewriteRule ^client/ - [L]

  # ----------------------------------------------------------------------
  # 2. Page Redirects (Strict Matches)
  # ----------------------------------------------------------------------
  
  # Root
  RewriteRule ^$ /en/ [R=301,L]
  
  # Top-level pages (No extension, strictly ends with / or nothing)
  RewriteRule ^festivals/?$ /en/festivals/ [R=301,L]
  RewriteRule ^about/?$ /en/about/ [R=301,L]
  RewriteRule ^join/?$ /en/join/ [R=301,L]
  
  # Artists Page (Redirects /artists or /artists/ to /en/artists/)
  # This MUST come before the image rewrite below
  RewriteRule ^artists/?$ /en/artists/ [R=301,L]

  # ----------------------------------------------------------------------
  # 3. Asset Rewriting (Relative Paths)
  # ----------------------------------------------------------------------
  
  # Artist Images (Only files with extensions, not directories)
  RewriteCond %{REQUEST_URI} \.[a-zA-Z0-9]+$
  RewriteRule ^artists/(.+)$ client/artists/$1 [L]
  
  # Standard Assets
  RewriteRule ^_astro/(.*)$ client/_astro/$1 [L]
  RewriteRule ^assets/(.*)$ client/assets/$1 [L]
  RewriteRule ^images/(.*)$ client/images/$1 [L]
  RewriteRule ^fonts/(.*)$ client/fonts/$1 [L]
  RewriteRule ^uploads/(.*)$ client/uploads/$1 [L]
  
  # Specific Files
  RewriteRule ^robots\.txt$ client/robots.txt [L]
  RewriteRule ^sitemap(.*)\.xml$ client/sitemap$1.xml [L]
  RewriteRule ^favicon\.(.*)$ client/favicon.$1 [L]
  RewriteRule ^logo\.svg$ client/logo.svg [L]
  
  # ----------------------------------------------------------------------
  # 4. Fallback Routing
  # ----------------------------------------------------------------------
  
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ client/$1/index.html [L]

</IfModule>
