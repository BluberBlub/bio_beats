---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { CheckCircle, XCircle, Loader2, ArrowRight } from "lucide-react";

// export const prerender = false; // SSG enabled

const pageTitle = "Verifying Email... â€” BIO BEATS";
---

<BaseLayout title={pageTitle}>
    <section class="min-h-[80vh] flex items-center justify-center py-16">
        <div class="container-narrow text-center">
            <div id="verifying" class="block">
                <div class="w-16 h-16 mx-auto mb-6 text-bio-accent">
                    <Loader2 className="w-full h-full animate-spin" />
                </div>
                <h1 class="text-2xl font-bold text-bio-white mb-2">
                    Verifying your email...
                </h1>
                <p class="text-bio-gray-400">
                    Please wait while we activate your account.
                </p>
            </div>

            <div id="success" class="hidden">
                <div
                    class="w-20 h-20 mx-auto rounded-full bg-green-500/20 flex items-center justify-center mb-8"
                >
                    <CheckCircle className="w-10 h-10 text-green-400" />
                </div>
                <h1 class="text-3xl font-bold text-bio-white mb-4">
                    Email Verified!
                </h1>
                <p class="text-bio-gray-400 text-lg mb-8">
                    Your account has been successfully activated. You can now
                    access all features.
                </p>
                <a
                    href="/profile"
                    class="btn-primary inline-flex items-center gap-2"
                >
                    Go to Dashboard
                    <ArrowRight className="w-4 h-4" />
                </a>
            </div>

            <div id="error" class="hidden">
                <div
                    class="w-20 h-20 mx-auto rounded-full bg-red-500/20 flex items-center justify-center mb-8"
                >
                    <XCircle className="w-10 h-10 text-red-500" />
                </div>
                <h1 class="text-3xl font-bold text-bio-white mb-4">
                    Verification Failed
                </h1>
                <p class="text-bio-gray-400 text-lg mb-8">
                    The verification link is invalid or has expired.
                </p>
                <a href="/contact" class="btn-secondary"> Contact Support </a>
            </div>
        </div>
    </section>
</BaseLayout>

<script>
    // Get token from URL query params
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("token");

    // Simulate verification process
    setTimeout(() => {
        const verifying = document.getElementById("verifying");
        const success = document.getElementById("success");
        const error = document.getElementById("error");

        if (verifying && success && error) {
            verifying.classList.add("hidden");

            if (token) {
                success.classList.remove("hidden");
                // In a real app, we would make an API call to verify the token here
                // and update the user session
            } else {
                // No token provided (or handle as error for now)
                // For now, since previous code simulated success regardless of token validity in client:
                success.classList.remove("hidden");
            }
        }
    }, 2000);
</script>
